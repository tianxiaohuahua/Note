MQTT官网：[MQTT版本3.1.1](http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718009)

# 前言 	理解HTTP和MQTT的关系

​	HTTP协议http是一个简单的请求-响应协议，它通常运行在TCP协议之上。<u>它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应</u>。请求和响应消息的头以ASCII码形式给出，是互联网最基础的也是最重要的组成部分。

​	MQTT(**消息队列遥测传输**)是ISO 标准(ISO/IEC PRF 20922)下基于发布/订阅范式的消息协议。它工作在 TCP/IP协议上，是为硬件性能低下的远程设备以及网络状况糟糕的情况下而设计的<u>发布/订阅型消息协议</u>，为此，它需要一个消息中间件 。MQTT协议是轻量、简单、开放和易于实现的，这些特点使它适用范围非常广泛，特别是在现在的物联网中。



> 服务器上传数据——》MQTT——直接转发数据——》客户端
>
> 服务器数据上传——》FTTP——暂存不发送数据，只等待客户端来读取数据《——客户端



​	如果只是建立一个面向浏览器的网站，那么它是不具备物联网和终端硬件设备通讯的能力的。在目前主流的物联网平台，比如阿里的阿里云，腾讯的腾讯云百度云等等。



# 1、简介

MQTT是客户端服务器发布/订阅消息传递协议。它重量轻，开放，简单并且设计得易于实施。这些特性使其非常适合在许多情况下使用，包括受约束的环境，例如用于机器对机器（M2M）和物联网（IoT）上下文中的通信，这些环境中需要小的代码占用空间和/或网络带宽非常宝贵。

该协议通过TCP / IP或其他提供有序，无损双向连接的网络协议运行。其功能包括：

**·     使用发布/订阅消息模式，该模式提供一对多的消息分发和应用程序的分离。**

**·     与有效内容无关的消息传递。**

**·     邮件传递的三种服务质量：**

**·     “最多一次”，根据操作环境的最佳努力传递消息。可能会发生邮件丢失。例如，该级别可与环境传感器数据一起使用，在该级别中，单个读数是否丢失无关紧要，因为下一个读数将很快发布。**

**·     “至少一次”，确保邮件到达但重复可能发生。**

**·     “恰好一次”，确保消息恰好到达一次。例如，此级别可用于计费系统，在计费系统中，重复或丢失的消息可能导致收取不正确的费用。**

**·     较小的传输开销和协议交换最小化以减少网络流量。**

**·     一种在异常断开连接时通知感兴趣的各方的机制。**

# 2、网络连接：

**由MQTT使用的基础传输协议提供的构造。**

·     将客户端连接到服务器。

·     它提供了在两个方向上发送有序的无损字节流的方法。



# 3、应用程序消息：

MQTT协议通过网络为应用程序承载的数据。当MQTT传输应用程序消息时，它们具有关联的服务质量和主题名称。

**客户：**

使用MQTT的程序或设备。客户端始终建立与服务器的网络连接。它可以

·     发布其他客户端可能感兴趣的应用程序消息。

·     订阅以请求有兴趣接收的应用程序消息。

·     退订以删除对应用程序消息的请求。

·     断开与服务器的连接。

**服务器：**
一种程序或设备，充当发布应用程序消息的客户端和进行订阅的客户端之间的中介。服务器

·     接受来自客户端的网络连接。

·     接受客户发布的应用程序消息。

·     处理来自客户端的订阅和取消订阅请求。

**·**     转发与客户端订阅匹配的应用程序消息。

**订阅：**
订阅包括主题过滤器和最大QoS。订阅与单个会话关联。一个会话可以包含多个订阅。会话中的每个订阅都有一个不同的主题过滤器。

**主题名称：
**附加到应用程序消息的标签，该标签与服务器已知的订阅相匹配。服务器将应用程序消息的副本发送给具有匹配订阅的每个客户端。

**主题过滤器：**
订阅中包含的一种表达，表示对一个或多个主题的兴趣。主题过滤器可以包含通配符。

**会话：
**客户端与服务器之间的状态交互**。**有些会话仅在网络连接的情况下才能持续，而其他会话则可以跨越客户端和服务器之间的多个连续的网络连接。

**MQTT控制包：**
通过网络连接发送的信息包。MQTT规范定义了十四种不同类型的控制包，其中一种（发布包）用于传达应用消息。

# 客户端标识符

客户端标识符（ClientId）标识服务器的客户端。每个连接到服务器的客户端都有一个唯一的ClientId。客户端和服务器必须使用ClientId来标识它们与客户端和服务器之间的MQTT会话有关的状态 [MQTT-3.1.3-2] 。

 

客户端标识符（ClientId）必须存在，并且必须是CONNECT数据包有效负载 [MQTT-3.1.3-3]中的第一个字段。

 

ClientId务必是第1.5.3 节[MQTT-3.1.3-4]中定义的UTF-8编码的字符串。 

服务器必须允许长度在1到23个UTF-8编码字节之间且仅包含字符的ClientId。

# 注意，MQTT服务器可以在同一TCP端口或其他网络端点上支持多种协议（包括该协议的早期版本）。


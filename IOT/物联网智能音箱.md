# 说明：

​		在未来将会有更多的机器人应用到家庭服务中去，本项目致力于家庭整体环境监控，物联网设别集中管理，老人监护等机器人功能的实现；核心是使用树莓派搭建一个服务形态机器人。使用语音识别、人脸识别、物联网等技术实现人机交互，机器人控制家居环境，以及基于互联网的云端控制监控网站功能的实现。

​	1、[视频效果展示](https://www.bilibili.com/video/av91023847)

​	2、[源代码码云地址](https://gitee.com/tianxiaohuahua/housekeeper_robot)

​	3、实际我是先在电脑上Ubuntu19.0系统上进行开发的，在电脑上实现了大部分功能以后才把代码转移到树莓派上的。因此就算没有树莓派也可以在一个linux系统上运行本项目！

​	4、本片笔记为总结和记录第一个阶段性的成果：基于树莓派的智能语音音箱的实现



# 主要结构的实现

## 	1、语音唤醒

​		使用了的开源GitHub资源：语音唤醒模型——snowboy  

​		因为在程序运行过程中不可能一直识别人在说什么，所以需要在用户在不需要和智能音箱对话时让其保持安静，但是又需要在和智能音箱对话时音箱可以自主启动程序进行交互。类似苹果手机的语音助手的唤醒过程。

​		snowbody可以实现一个程序等待的过程，一次对话结束后会进入snowboy的等待唤醒程序中组织程序继续执行，从而达到节约资源和音箱休眠的过程。在此器件，snowboy会进入一个消耗系统资源很小的一个进程中不断监听麦克风，监听麦克风固定的唤醒词，一旦有唤醒词出现就会跳出等待，唤醒智能音箱。

## 	2、语音识别

​		使用百度API作为语音识别引擎，需要联网才能识别录音数据。

​		首先需要去百度平台去注册一个语音识别的账户和设别，然后再自己的程序中接入百度API：

```python
from aip import AipSpeech #导入百度语音的ａｐｉ

"""导入ａｉｐ接口"""
"""分别导入APPID  AK  SK  对应了我的百度账号"""
app_id = "你的百度账户"
API_Key = "你的百度账户"
Secret_Key = "你的百度账户"


"""代入相关的账户信息创建了语音识别对象clien"""
client = AipSpeech(app_id, API_Key, Secret_Key)
```

​		在使用的过程中需要为百度语音识别提供语音录音文件，需要录音文件时WAV格式，并且录音时长好像不能超过十秒钟。把数据传输给百度API后，云端快速识别并返回给程序一个字符串就是识别出来的语音内容。

​		并且百度API还可以实现把字符串翻译成可以播放的录音文件，以及设置录音文件里面的声音。也就是把字符串上传个百度的服务器，服务器返回一串数据，数据就是音频文件，把文件保存成可以播放的MP3或称WAV文件都可以，再把音频文件使用扬声器播放出来。

## 3、串口服务模块

​		因为我需要通过串口控制一个单片机，所以设置了串口通讯的部分。当然也可以不设置这个模块，因为完全可以用网络通讯来控制单片机，但是在我的设计中考虑到需要设计的是一个机器人管家，需要整个机器人不但要由语音视频系统，还需要运动和大量传感器连接，这就需要一个单片机来接手这些比较单一的控制。

​		考虑到可移植性，我没有把单片机的串口直接和树莓派的串口引脚相连，而是使用一个串口转usb的芯片CH340来接发数据。单片机发送的数据通过串口芯片转换成USB的数据，并且整体结合成一体。单片机再使用USB和树莓派相连。

​		串口通讯使用了serial 模块，可以很方便的处理数据。串口发送和接收在两个子线程中打开使用，因为实际测试过程中发现，串口读取和发送使用同一个串口对象会发生接受串口信息丢失的现象 ，需要在两个子线程中分别实例化两个串口对象，一个用来发送，一个接收。

## 4、使用TCP/IP协议连接ESP8266

​		为了实现一定的物理网控制功能，我使用了乐鑫公司的研发的物理网芯片ESP8266来进行物理网开发。这里我暂时没有做过多的开发，只是使用电脑上面插了一个ESP8266来作为一个设备端通过局域网连接到了树莓派，在语音系统接收到了需要控制整个物理网设备的时候就会向它发送数据，同时该设别也可以随时向树莓派发送自己的数据。



## 5、多线程

​		建立多线程主要是为了解决串口通讯，物理网通讯和语音系统之间的矛盾。简单来说是需要这些部分之间需要并行运行才可以。

​		这里使用了python3.7的模块Threading。众所周知！线程之间是很难进行数据交互的，你可以使用别的线程里面变量的值，但是不能在这个线程中改变另一个线程的里面一个变量的值！因此就需要把数据改来改去，能力有限，有点麻烦。



